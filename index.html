<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Đăng nhập</title>
    <link rel="stylesheet" href="/assets/css/home.css">
</head>
<body>
    <div class="container">
        <h1>Đăng nhập</h1>
        <form action="login.php" method="post" id="loginForm">
            <input type="text" name="username" placeholder="Tên đăng nhập">
            <input type="password" name="password" placeholder="Mật khẩu">
            <button type="submit">Đăng nhập</button>
            <p class="error" style="display: none;"></p>
        </form>
    </div>
    <script>
        const form = document.getElementById('loginForm');
        const errorElement = form.querySelector('.error');

        form.addEventListener('submit', (event) => {
            event.preventDefault();

            const username = form.querySelector('input[name="username"]').value;
            const password = form.querySelector('input[name="password"]').value;

            // Gọi hàm so sánh login
            compareLogin(username, password);
        });

        function compareLogin(username, password) {
            const xhr = new XMLHttpRequest();
            xhr.open("POST", "login.php");
            xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");

            xhr.onload = function() {
                if (xhr.status === 200) {
                    const response = JSON.parse(xhr.responseText);
                    if (response.success) {
                        window.location.href = "home.html";
                    } else {
                        switch(response.error) {
                            case 'empty':
                                errorElement.textContent = "Vui lòng nhập đủ thông tin tài khoản và mật khẩu";
                                break;
                            case 'incorrect_username':
                                errorElement.textContent = "Không tìm thấy tên người dùng";
                                break;
                            case 'incorrect_password':
                                errorElement.textContent = "Mật khẩu không chính xác";
                                break;
                            default:
                                errorElement.textContent = "Đăng nhập thất bại!";
                        }
                        errorElement.style.display = 'block';
                    }
                } else {
                    console.error("Lỗi kết nối đến server!");
                }
            };
            
            xhr.send(`username=${username}&password=${password}`);
        }
    </script>
</body>
</html>
