<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>IZONE Institute</title>
<!-- Custom CSS -->
<link rel="stylesheet" href="http://127.0.0.1/ISD_Project/assets/css/home.css">
<style>
.main {
  height: auto;
  width: calc(100% - 260px);
}

.open-popup {
  left: 35%;
}

.input-box label {
    font-weight: 600;
}

.error-message {
  color: red;
  font-style: italic;
  font-size: smaller;
  }
</style>
</head>

<body>
<div class="container">
  <div class="topbar">
    <div class="logo">
      <a href="home.html"><img id="logo" src="assets/img/izone-logo-color.png" alt="logo"></a>
    </div>
    <div class="login-btn"></div>
    <a href="index.html" class="btn">Log out</a>
  </div>
  <div class="sidebar">
    <ul>
      <li>
        <a href="student.html">
          <div>STUDENT</div>
        </a>
      </li>
      <li>
        <a href="performance.html">
          <div>PERFORMANCE</div>
        </a>
      </li>
      <li>
        <a href="class.html">
          <div>CLASS</div>
        </a>
      </li>
      <li>
        <a href="admin.html">
          <div>ADMIN</div>
        </a>
      </li>
    </ul>
  </div>
  <div class="main">
    <!-- Thanh tìm kiếm -->
    <div class="per-button">
        <button type="button" class="select-btn" id="completedBtn">Completed</button>
        <button type="button" class="select-btn" id="studyingBtn">Studying</button>
    </div>
  
    <div class="st-title">
      <div class="header">
        <h2>Class List</h2>
        <div class="box">
          <button type="button" class="search-btn add-btn">Add</button>
          <input type="text" class="search-input" id="searchInput" placeholder="Search...">
        </div>
      </div>
    <!-- Bảng danh sách học sinh -->
     
      <table class="student-table" id="classData">
        <thead>
        <tr>
          <th>Class ID</th>
          <th>Level</th>
          <th>Teacher</th>
          <th>Opening Day</th>
          <th>Ending Day</th>
          <th>Student</th>
          <th>Function</th>
        </tr>
        </thead>
        <tbody>
        <!-- Dữ liệu sinh viên sẽ được thêm vào đây bằng JavaScript -->
        </tbody>
      </table>  
    </div>
  </div>
</div>

<!-- Popup for editing class information -->
<div id="open-popup" class="open-popup">
  <div class="popup-title">
  <h2>Class</h2>
  <p class="close-menu">X</p>
  </div>

  <div class="st-container">
    <div class="st-box">
      <h3 class="box-content">Class Information</h3>
      <div class="st-form">
        <form id="editclassForm">
          <div class="column">
            <div class="input-box">
              <label for="editClassID">Class ID</label>
              <input type="text" id="editClassID" name="editClassID" placeholder="Loading..." readonly>
            </div>
            <div class="input-box">
              <label for="editLevel">Level</label>
              <input type="text" id="editLevel" name="editLevel" placeholder="Loading...">
              <div id="editLevelError" class="error-message"></div>
            </div>
            <div class="input-box">
              <label for="editStatus">Status</label>
              <input type="text" id="editStatus" name="editStatus" placeholder="Loading...">
              <div id="editStatusError" class="error-message"></div>
            </div>
            <div class="input-box">
              <label for="editTeacher">Teacher</label>
              <input type="text" id="editTeacher" name="editTeacher" placeholder="Loading...">
              <div id="editTeacherError" class="error-message"></div>
            </div>
          </div>

          <div class="column">
            <div class="input-box">
              <label for="editOpeningDay">Opening Day</label>
              <input type="date" id="editOpeningDay" name="editOpeningDay" placeholder="Loading...">
              <div id="editOpeningDayError" class="error-message"></div>
            </div>
            <div class="input-box">
              <label for="editEndingDay">Ending Day:</label>
              <input type="date" id="editEndingDay" name="editEndingDay" placeholder="Loading...">
              <div id="editEndingDayError" class="error-message"></div>
            </div>
          </div>
        </form>
      </div>
    </div>

   
    <div class="column">
      <!-- Save changes button -->
      <div class="change-btn" id="saveChangesBtn">Save changes</div>
    </div>
  </div>
</div>

<!-- Popup for adding class information -->
<div id="open-popup-add" class="open-popup">
  <div class="popup-title">
    <h2>Add Class</h2>
    <p class="close-add-menu">X</p>
  </div>
  <div class="st-container">
    <div class="st-box">
      <h3 class="box-content">Class Information</h3>
      <div class="st-form">
        <form id="addclassForm">
          <div class="column">
            <div class="input-box">
              <label for="addClassID">Class ID</label>
              <input type="text" id="addClassID" name="addClassID">
              <div id="addClassIDError" class="error-message"></div>
            </div>
            <div class="input-box">
              <label for="addLevel">Level</label>
              <input type="text" id="addLevel" name="addLevel">
              <div id="addLevelError" class="error-message"></div>
            </div>
            <div class="input-box">
              <label for="addTeacher">Teacher</label>
              <input type="text" id="addTeacher" name="addTeacher">
              <div id="addTeacherError" class="error-message"></div>
            </div>
          </div>
          <div class="column">
            <div class="input-box">
              <label for="addOpeningDay">Opening Day</label>
              <input type="date" id="addOpeningDay" name="addOpeningDay">
              <div id="addOpeningDayError" class="error-message"></div>
            </div>
            <div class="input-box">
              <label for="addEndingDay">Ending Day:</label>
              <input type="date" id="addEndingDay" name="addEndingDay">
              <div id="addEndingDayError" class="error-message"></div>
            </div>
          </div>
        </form>
  </div>
</div>

    <div class="column">
      <!-- Save add button -->
      <div class="change-btn" id="saveAddBtn">Save add</div>
    </div>
  </div>
</div>

<!-- Popup for deleting class information -->
<div id="open-popup-delete" class="change-popup">
  <div class="popup-title">
    <h2>Delete Class</h2>
  </div>
  <div class="st-container">
    <div class="st-box">
      <h3 class="box-content">Are you sure to delete this class?</h3>
    </div>
    <div class="column">
      <div class="delete-btn" id="confirmDeleteBtn">Save</div>
      <div class="cancel-btn" id="cancelDeleteBtn">Cancel</div>
    </div>
  </div>
</div>

<!-- Popup for deleting student information -->
<div id="open-popup-delete-student" class="change-popup">
  <div class="popup-title">
    <h2>Delete Student</h2>
  </div>
  <div class="st-container">
    <div class="st-box">
      <h3 class="box-content">Are you sure to delete this student?</h3>
    </div>
    <div class="column">
      <div class="delete-btn" id="confirmDeleteBtnStu">Save</div>
      <div class="cancel-btn" id="cancelDeleteBtnStu">Cancel</div>
    </div>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
  let currentStatus = 'Completed';

  getClassData(currentStatus);

  const completedBtn = document.getElementById('completedBtn');
  const studyingBtn = document.getElementById('studyingBtn');

  completedBtn.addEventListener('click', function() {
    currentStatus = 'Completed';
    searchClass();
  });

  studyingBtn.addEventListener('click', function() {
    currentStatus = 'Studying';
    searchClass();
  });

  document.getElementById('searchInput').addEventListener('keypress', function(event) {
    if (event.key === 'Enter') {
      searchClass();
    }
  });

  document.getElementById('saveChangesBtn').addEventListener('click', function() {
    saveChanges();
  });

  // Gắn sự kiện khi nhấn nút "Save Add "
  document.getElementById('saveAddBtn').addEventListener('click', function() {
    saveAdd();
  });

      // Gắn sự kiện cho nút Add
      attachAddEventListeners();

  function searchClass() {
    const searchInput = document.getElementById('searchInput').value.trim().toLowerCase();
    getClassData(currentStatus, searchInput);
  }

  function getClassData(status, search = '') {
    let url = `assets/php/class.php?status=${status}`;
    if (search !== '') {
      url += `&search=${search}`;
    }
    fetch(url)
      .then(response => response.json())
      .then(data => {
        const classTable = document.getElementById('classData');
        const tbody = classTable.querySelector('tbody');
        tbody.innerHTML = '';

        data.forEach(classInfo => {
          const row = document.createElement('tr');
          row.innerHTML = `
            <td>${classInfo.ClassID}</td>
            <td>${classInfo.Level}</td>
            <td>${classInfo.Teacher}</td>
            <td>${classInfo.OpeningDay}</td>
            <td>${classInfo.EndingDay}</td>
            <td>
              <button class="search-btn list-btn" data-classid="${classInfo.ClassID}">List</button>
            </td>
            <td>
              <button class="search-btn edit-btn" data-classid="${classInfo.ClassID}">Edit</button>
              <button class="search-btn delete-btn" data-classid="${classInfo.ClassID}">Delete</button>
            </td>
          `;
          tbody.appendChild(row);
        });

        attachEditEventListeners();
        attachDeleteEventListeners();
      })
      .catch(error => console.error('Error fetching data:', error));
  }

  function attachEditEventListeners() {
    const editButtons = document.querySelectorAll('.edit-btn');
    const editPopup = document.getElementById("open-popup");
    const cancelEditButton = editPopup.querySelector(".close-menu");

    editButtons.forEach(button => {
        button.addEventListener('click', function() {
            const classId = this.getAttribute("data-classid");

            fetch(`assets/php/classinfor.php?classId=${classId}`)
            .then(response => response.json())
            .then(data => {
                document.getElementById('editClassID').value = classId;
                document.getElementById('editLevel').value = data.Level;
                document.getElementById('editTeacher').value = data.Teacher;
                document.getElementById('editOpeningDay').value = data.OpeningDay;
                document.getElementById('editEndingDay').value = data.EndingDay;
                document.getElementById('editStatus').value = data.Status;

                editPopup.style.display = "block"; 
            })
            .catch(error => {
              console.error('Error fetching class data:', error);
            });
        });
    });

    cancelEditButton.addEventListener("click", function() {
      editPopup.style.display = "none";
    });
  }

  function saveChanges() {
    const form = document.getElementById('editclassForm');
    const formData = new FormData(form);
    formData.append('classId', document.getElementById('editClassID').value);

    fetch('assets/php/classchange.php', {
        method: 'POST',
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert('Class information updated successfully');
            document.getElementById("open-popup").style.display = "none";
            getClassData(currentStatus);
        } else {
            const errorElements = form.querySelectorAll(".error-message");
            errorElements.forEach(element => {
              element.innerHTML = '';
            });

            for (const field in data.error) {
              const errorElement = form.querySelector(`#${field}Error`);
              errorElement.innerHTML = data.error[field];
            }
        }
    })
    .catch(error => {
        console.error('Error saving changes:', error);
    });
  }

  function attachDeleteEventListeners() {
    const deleteButtons = document.querySelectorAll('.delete-btn');
    deleteButtons.forEach(button => {
        button.addEventListener('click', function() {
            const classId = this.getAttribute("data-classid");
            const confirmation = confirm("Are you sure you want to delete this class?");
            if (confirmation) {
                fetch(`assets/php/classdelete.php?classId=${classId}`, { method: 'GET' })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert('Class deleted successfully');
                        getClassData(currentStatus);
                    } else {
                        alert('Error deleting class: ' + data.error);
                    }
                })
                .catch(error => {
                    console.error('Error deleting class:', error);
                });
            }
        });
    });
  }

      // Popup functionality for Add button
      function attachAddEventListeners() {
      const addButton = document.querySelector(".add-btn");
      const addPopup = document.getElementById("open-popup-add");
      const cancelAddButton = addPopup.querySelector(".close-add-menu");

      if (!addPopup) {
        console.error("Popup element not found. Check if the selector is correct.");
        return;
      }

      if (!cancelAddButton) {
        console.error("Close button for popup not found. Check if the selector is correct.");
        return;
      }

      // Sự kiện cho nút "Add"
      addButton.addEventListener("click", function() {
      // Ẩn tất cả các popup khác trước khi hiển thị popup thêm mới
      document.querySelectorAll('.open-popup').forEach(popup => {
      popup.style.display = "none";
    });
      addPopup.style.display = "block";
    });

      // Sự kiện cho nút đóng Addpopup
      cancelAddButton.addEventListener("click", function() {
        addPopup.style.display = "none";
        window.location.reload();
      });

    }

  // Function to save new class
  function saveAdd() {
    clearErrorMessages(); // Clear previous error messages
    const form = document.getElementById('addclassForm');
    const formData = new FormData(form);

    fetch('assets/php/classadd.php', {
      method: 'POST',
      body: formData
    })
    .then(response => response.json())
    .then(data => {
      // Xóa các thông báo lỗi cũ
      document.querySelectorAll('.error-message').forEach((element) => {
        element.textContent = '';
      });

      if (data.success) {
        alert(data.message);
        // Reset form và ẩn popup
        form.reset();
        popup.classList.remove("open-popup");
      } else {
        // Hiển thị thông báo lỗi
        for (const [key, value] of Object.entries(data.error)) {
          const errorElement = document.getElementById(`${key}Error`);
          if (errorElement) {
            errorElement.textContent = value;
          }
        }
      }
    })
    .catch(error => {
      console.error("Error:", error);
    });
  }

  // Function to clear error messages
  function clearErrorMessages() {
    const errorSpans = document.querySelectorAll('.error-message');
    errorSpans.forEach(span => {
      span.textContent = '';
    });
  }


});

</script>

</body>
</html>



